	GET Definition.asm
	EXPORT SystemInit
	EXPORT Main 	
	EXPORT TIM6_DAC_IRQHandler
	AREA GeneralCodeSector,CODE,READONLY
	
InitPortsIO PROC
	;-------------------GPIOA-------------------
	LDR R0,=GPIOA+MODER
	;=========1=1=1=1=1=1=0=0=0=0=0=0=0=0=0=0=
	;=========5=4=3=2=1=0=9=8=7=6=5=4=3=2=1=0= 
	LDR R1,=2_00000000000000000000000000000000
	STR R1,[R0]
	LDR R0,=GPIOA+OSPEEDR
	;=========1=1=1=1=1=1=0=0=0=0=0=0=0=0=0=0=
	;=========5=4=3=2=1=0=9=8=7=6=5=4=3=2=1=0= 
	LDR R1,=2_00000000000000000000000000000000
	STR R1,[R0]
	LDR R0,=GPIOA+PUPDR
	;=========1=1=1=1=1=1=0=0=0=0=0=0=0=0=0=0=
	;=========5=4=3=2=1=0=9=8=7=6=5=4=3=2=1=0= 
	LDR R1,=2_00000000000000000000000000000000
	STR R1,[R0]
	;-------------------GPIOB-------------------
	LDR R0,=GPIOB+MODER
	;=========1=1=1=1=1=1=0=0=0=0=0=0=0=0=0=0=
	;=========5=4=3=2=1=0=9=8=7=6=5=4=3=2=1=0= 
	LDR R1,=2_00000000000000000000000000000000
	STR R1,[R0]
	LDR R0,=GPIOB+OSPEEDR
	;=========1=1=1=1=1=1=0=0=0=0=0=0=0=0=0=0=
	;=========5=4=3=2=1=0=9=8=7=6=5=4=3=2=1=0= 
	LDR R1,=2_00000000000000000000000000000000
	STR R1,[R0]
	LDR R0,=GPIOB+PUPDR
	;=========1=1=1=1=1=1=0=0=0=0=0=0=0=0=0=0=
	;=========5=4=3=2=1=0=9=8=7=6=5=4=3=2=1=0= 
	LDR R1,=2_00000000000000000000000000000000
	STR R1,[R0]
	;-------------------GPIOC-------------------
	LDR R0,=GPIOC+MODER						   	
	;=========1=1=1=1=1=1=0=0=0=0=0=0=0=0=0=0= 
	;=========5=4=3=2=1=0=9=8=7=6=5=4=3=2=1=0= 
	LDR R1,=2_00000000000001010000000000000000
	STR R1,[R0]
	LDR R0,=GPIOC+OSPEEDR
	;=========1=1=1=1=1=1=0=0=0=0=0=0=0=0=0=0=
	;=========5=4=3=2=1=0=9=8=7=6=5=4=3=2=1=0= 
	LDR R1,=2_00000000000011110000000000000000
	STR R1,[R0]
	LDR R0,=GPIOA+PUPDR
	;=========1=1=1=1=1=1=0=0=0=0=0=0=0=0=0=0=
	;=========5=4=3=2=1=0=9=8=7=6=5=4=3=2=1=0= 
	LDR R1,=2_00000000000000000000000000000000
	STR R1,[R0]
	BX LR
	ENDP

InitSystemClock PROC
	LDR R0,=RCC+RCC_CFGR
	LDR R1,=2_00000000000000000000000000000000
	STR R1,[R0]

WaitHSI
;	LDR R0,[RCC+RCC_CFGR]
	LDR R1,[R0]
	

	LDR R0,=RCC+RCC_CR
	LDR R1,=2_00000001000000000000000000000001
	STR R1,[R0]
	
	LDR R0,=RCC+RCC_CFGR
	LDR R1,=2_00000101001010000000000000000010
	STR R1,[R0]
	
	LDR R0,=RCC+RCC_AHBENR
	LDR R1,=2_00000000000010100000000000000000
	STR R1,[R0]
	
	LDR R0,=RCC+RCC_APB2ENR
	LDR R1,=2_00000000000000000001100000000000
	STR R1,[R0]

	LDR R0,=RCC+RCC_APB1ENR
	LDR R1,=2_00100000000000000000000000010000
	STR R1,[R0]
	BX LR
	ENDP
	
SystemInit PROC
;-------------------------------------------
    ;LDR R2,=Temp1
	;LDR R1,=0x34569878
	;STR R1,[R2];Write
	;LDR R1,=0x00000000
	;LDR R3,[R2];Read
	;LDRH R4,[R2]
	;LDRB R5,[R2]
	;=======
	PUSH {R0,LR}
	LDR R0,=InitSystemClock
	BLX R0	
	LDR R0,=InitPortsIO
	BLX R0
	LDR R0,=TIM6+TIM6_CR1
	LDR R1,=0x01
	STR R1,[R0]
	LDR R0,=TIM6+TIM6_DIER
	LDR R1,=0x01
	STR R1,[R0]
	LDR R0,=TIM6+TIM6_PSC
	LDR R1,=0x000F
	STR R1,[R0]
	LDR R0,=TIM6+TIM6_ARR
	LDR R1,=0xFFFF
	STR R1,[R0]
	LDR R0,=GPIOC+ODR
	LDR R1,=Pin8
	STR R1,[R0]
	LDR R0,=ISER
	LDR R1,=0x20000
	STR R1,[R0]
	CPSIE i
	POP {R0,PC}
	BX LR
	ENDP
   
Main PROC
	WFI
	B Main
	ENDP

TIM6_DAC_IRQHandler PROC
	
	LDR R0,=GPIOA+IDR
	LDR R1,[R0]
	LDR R0,=0x0001
	ANDS R1,R1,R0
	BEQ SkipBLinkLed 
	
	LDR R0,=GPIOC+ODR
	LDR R1,[R0]
	LDR R2,=0x0100
	EORS R2,R2,R1
	STR R2,[R0]

SkipBLinkLed	
	WriteIn TIM6+TIM6_SR,0x0000	
	WriteIn ICPR,0x20000	
	BX LR
	ENDP
;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	AREA RAMData,DATA,READWRITE
Temp1 DCW 0x00
Temp2 DCB 0x01
  END
 